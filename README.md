# Desafio T√©cnico B2BFlow - Disparador de Mensagens WhatsApp

![Python](https://img.shields.io/badge/python-3.9+-blue.svg)
![Tests](https://img.shields.io/badge/tests-pytest-green.svg)
![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)

## üìÑ Descri√ß√£o do Projeto

Este projeto √© a solu√ß√£o para o desafio t√©cnico de **Est√°gio em Desenvolvimento Python** da b2bflow. A aplica√ß√£o automatiza o envio de mensagens de sauda√ß√£o via WhatsApp para uma lista de contatos armazenada em um banco de dados Supabase, utilizando Python e a Z-API.

O sistema foi constru√≠do com foco em boas pr√°ticas de engenharia de software, incluindo uma arquitetura orientada a objetos, valida√ß√£o robusta de dados, logging detalhado e uma su√≠te de testes automatizados com Pytest para garantir a qualidade e a confiabilidade do c√≥digo.

## ‚ú® Funcionalidades Principais

- **Integra√ß√£o com Supabase**: Leitura de contatos diretamente de uma tabela no banco de dados.
- **Envio via Z-API**: Orquestra√ß√£o do envio de mensagens personalizadas.
- **Valida√ß√£o de Dados**:
    - Verifica√ß√£o de nomes v√°lidos (n√£o nulos ou vazios).
    - Valida√ß√£o de formato de n√∫meros de celular brasileiros via Regex (`55XX9XXXXXXXX`).
    - Tratamento e descarte de contatos com n√∫meros de telefone duplicados.
- **Logging Detalhado**: Registra todas as opera√ß√µes, sucessos, avisos e falhas.
- **Testes Unit√°rios**: Cobertura de testes com Pytest para garantir a corretude da l√≥gica de neg√≥cio.
- **Arquitetura Limpa**: C√≥digo modularizado em classes de servi√ßo para uma clara separa√ß√£o de responsabilidades.

## üõ†Ô∏è Constru√≠do Com

- **[Python](https://www.python.org/)** - A linguagem de programa√ß√£o utilizada.
- **[Supabase](https://supabase.com/)** - Plataforma de Backend como Servi√ßo (BaaS).
- **[Z-API](https://www.z-api.io/)** - API para envio de mensagens no WhatsApp.
- **[Pytest](https://docs.pytest.org/en/7.1.x/)** - Framework para testes em Python.
- **[Requests](https://requests.readthedocs.io/en/latest/)** - Biblioteca para fazer requisi√ß√µes HTTP.
- **[Python Decouple](https://pypi.org/project/python-decouple/)** - Para gerenciar as vari√°veis de ambiente.

## üìÇ Estrutura do Projeto

```
b2bflow-desafio/
‚îú‚îÄ‚îÄ .env.example        # Exemplo de arquivo de vari√°veis de ambiente
‚îú‚îÄ‚îÄ .gitignore          # Arquivos e pastas ignorados pelo Git
‚îú‚îÄ‚îÄ main.py             # Ponto de entrada da aplica√ß√£o
‚îú‚îÄ‚îÄ README.md           # Este arquivo
‚îú‚îÄ‚îÄ requirements.txt    # Lista de depend√™ncias do projeto
‚îú‚îÄ‚îÄ supabase_service.py # M√≥dulo para interagir com o Supabase
‚îú‚îÄ‚îÄ zapi_service.py     # M√≥dulo para interagir com a Z-API
‚îî‚îÄ‚îÄ tests/              # Pasta com os testes unit√°rios
    ‚îú‚îÄ‚îÄ test_validators.py
    ‚îî‚îÄ‚îÄ test_services.py
    ‚îî‚îÄ‚îÄ test_main.py
```

---
## üöÄ Instala√ß√£o e Execu√ß√£o

### 1. Pr√©-requisitos
- **Python 3.9+** e **Pip**
- **Conta no Supabase**: Um projeto com uma tabela `contatos`.
- **Conta na Z-API**: Uma inst√¢ncia ativa para o envio de mensagens.

### 2. Setup do Ambiente

1.  **Clone o Reposit√≥rio:**
    ```bash
    git clone https://github.com/tioRaffa/b2bflow-desafio.git
    cd b2bflow-desafio
    ```

2.  **Crie a Tabela no Supabase:**
    Use o script SQL abaixo no "SQL Editor" do seu projeto Supabase para criar a tabela necess√°ria.
    ```sql
    CREATE TABLE public.contatos (
      id bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY,
      created_at timestamp with time zone NOT NULL DEFAULT now(),
      nome_contato text NULL,
      numero_telefone text NULL,
    );
    ```

3.  **Configure as Vari√°veis de Ambiente:**
    Crie um arquivo `.env` na raiz do projeto (voc√™ pode copiar o `.env.example`) e preencha com suas credenciais.
    ```ini
    # .env
    # Supabase
    SUPABASE_URL="SUA_URL_DO_SUPABASE"
    SUPABASE_KEY="SUA_CHAVE_ANON_DO_SUPABASE"

    # Z-API
    ZAPI_INSTANCE_ID="SEU_ID_DE_INSTANCIA_ZAPI"
    ZAPI_TOKEN="SEU_TOKEN_DA_INSTANCIA_ZAPI"
    CLIENT_TOKEN="SEU_CLIENTE_TOKEN_DA_INSTANCIA_ZAPI"
    ```

4.  **Crie e Ative um Ambiente Virtual:**
    ```bash
    # Crie o ambiente
    python -m venv .venv
    # Ative o ambiente (Windows)
    .venv\Scripts\activate
    # Ative o ambiente (macOS/Linux)
    source .venv/bin/activate
    ```

5.  **Instale as Depend√™ncias:**
    ```bash
    pip install -r requirements.txt
    ```

### 3. Executando a Aplica√ß√£o
Para iniciar o processo de envio de mensagens, execute o script `main.py`:
```bash
python main.py
```

---
## üß™ Executando os Testes

O projeto possui uma su√≠te de testes para garantir a qualidade do c√≥digo. Para executar os testes, utilize o `pytest` na raiz do projeto:

```bash
pytest
```
A sa√≠da esperada para uma execu√ß√£o bem-sucedida √©:
```text
============================= test session starts ==============================
...
collected X items

tests/test_validators.py::test_valid_name_success PASSED                  [ 25%]
tests/test_validators.py::test_invalid_name_is_empty PASSED               [ 50%]
tests/test_validators.py::test_valid_brazilian_number_success PASSED      [ 75%]
tests/test_validators.py::test_invalid_number_format PASSED               [100%]

============================== X passed in Y.YYs ===============================
```

---
## ‚öôÔ∏è Exemplo de Execu√ß√£o
A sa√≠da do terminal demonstra o processo de valida√ß√£o e envio:
```text
2025-08-12 17:50:10,123 - INFO - Iniciando processo de envio de mensagem..
2025-08-12 17:50:10,234 - INFO - Servi√ßo Supabase iniciado com sucesso.
2025-08-12 17:50:10,235 - INFO - Servi√ßo Z-API iniciado com sucesso.
2025-08-12 17:50:10,236 - INFO - Buscando contatos no Supabase...
2025-08-12 17:50:11,001 - INFO - 4 contatos encontrados no total. Iniciando valida√ß√£o...
2025-08-12 17:50:11,002 - WARNING - Contato descartado por ser inv√°lido. Nome: 'Contato Teste', Telefone: '12345'.
2025-08-12 17:50:11,003 - INFO - Valida√ß√£o conclu√≠da. 3 de 4 contatos s√£o v√°lidos.
2025-08-12 17:50:11,004 - INFO - Enviando mensagem para 'Ana Paula' (5549...5247)...
2025-08-12 17:50:11,850 - INFO - Mensagem para 'Ana Paula' enviada com sucesso!
2025-08-12 17:50:11,851 - INFO - Enviando mensagem para 'Gefferson' (5549...7907)...
2025-08-12 17:50:12,600 - INFO - Mensagem para 'Gefferson' enviada com sucesso!
2025-08-12 17:50:12,601 - INFO - Enviando mensagem para 'Carlos' (5511...1234)...
2025-08-12 17:50:13,400 - INFO - Mensagem para 'Carlos' enviada com sucesso!
2025-08-12 17:50:13,401 - INFO - Processo Finalizado
```

## ‚úÖ Resultado Final
<details>
  <summary>‚ñ∂Ô∏è Informa√ß√µes de contato INV√ÅLIDO </summary>
  <img width="1392" height="239" alt="Image" src="https://github.com/user-attachments/assets/995bbd89-b507-4948-b198-a5b2fb36c16c" />
</details>
<details>
  <summary>‚ñ∂Ô∏è Informa√ß√µes de contato V√ÅLIDOS </summary>
  <img width="1380" height="330" alt="Image" src="https://github.com/user-attachments/assets/159f1995-daa3-4da3-a395-e32dc26c80d7" />
</details>

> **Nota sobre a Captura de Tela do Resultado no WhatsApp:**
>
> O c√≥digo do projeto est√° 100% funcional e a l√≥gica de envio para a API da Z-API foi implementada e validada com sucesso, como pode ser comprovado nesta se√ß√£o que exibe os logs do terminal com o status de "Mensagem enviada com sucesso!".
>
> No entanto, devido a uma instabilidade t√©cnica externa na plataforma da Z-API que impede restabelecer a conex√£o com a inst√¢ncia existente via QR Code e codigo, n√£o foi poss√≠vel gerar a captura de tela final das mensagens sendo recebidas no WhatsApp.
>
> A imagem ser√° inclu√≠da neste `README` assim que o servi√ßo de conex√£o da Z-API for normalizado.

---

**Autor:** `RAFAEL MUNIZ`
